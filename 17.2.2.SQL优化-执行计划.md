# 3.sql优化：

####     1.在查询表汇总的所有列的时候尽量使用具体的列名，而不是用*.

####     2.在清除表中所有数据的时候尽量使用truncate来代替delete。

```plsql
drop>truncate>delete
```

####     3.在PL/SQL块结束的时候尽量所使用commit来提交事务。

####     4.要合理的使用exists和in关键字

​       如果子查询中的数据量比较小，则建议使用in

​       如果子查询中的数据量比较大，则建议使用exists

​       一般在实际的工作过程中，数据量都比较大，所以推荐使用exists

####     5.在查询的时候尽量减少表的查询次数。

####     6.表关联的时候在写where条件的时候，尽量将过滤条件写在关联条件的后面（也就是在where条件中尽量将

​    能够过滤掉多的数据的条件写到后面）。

####     7.尽量避免全表扫描

##### 		7.1.在查询的时候没有写任何的过滤条件。

##### 		7.2.在查询的时候没有为过滤的字段创建索引。

##### 		7.3.创建了索引，但是索引失效了。

####     8.合理的利用索引。

####     9.sql的关键字尽量大写。  



# 4.执行计划

​    主要就是系统预估的每一条sql语句的执行的顺序以及花费的一些资源和成本。

​    在PL/SQL工具中查看执行计划直接使用F5键来操作。



#### 4.1执行计划常见的参数：

```plsql
rows(基数):Oracle预估每一步结束之后返回的行数

bytes(字节):Oracle预估每一步结束之后返回的字节数

cost(耗费)：预估CPU消耗，理论上值越小越好，但是该值可能会跟实际的情况有出入。

time(时间)：每一步执行所消耗的时间。
```

  

#### 4.2执行计划主要查看的内容：

####   4.2.1.表扫描方式：

#####     table access full:全表扫描

​        一般情况下如果表中的数据量比较大的话不建议进行全表扫描。

​          通过该字段就可以查询我们设置的索引是否在查询的时候生效。

#####    table access by index scan:通过索引直接进行扫描。

#####    table access by index rowid:先通过索引来定位数据所在的rowid的范围，然后再从该范围中查询具体的数据。

#### 	4.2.2.表连接方式：

#### 		4.2.2.1.hash join(哈希连接)：

​      先选择一张表，计算表中的关联字段的hash值，将hash值和其他的数据先保存到内存中，然后再将另一张表中

​      关联的字段进行hash值的计算然后匹配，如果匹配到了则将数据保存到结果集中。

######       优点：性能比较好，大大减少了表之间的关联次数。

######       缺点：该种方式对内存的要求比较高，所以一般情况下小表关联大表的时候可以使用该种方式



#### 		4.2.2.2.nested loops（循环嵌套连接）:

  先从一张表中读取出来一条数据，然后再和另外一张表中的数据进行一一匹配，如果匹配到则将数据保存到结果集，然后再从第一张表中拿出一条数据，继续进行匹配。

######   优点：内存占用比较少。

######   缺点：由于要不断地从磁盘中读取数据，所以效率比较低。

#### 		4.2.2.3.sort merge join（排序合并连接）：

 先将两张表按照关联的字段进行排序，形成两张临时表，随机拿出来一张表和另外一张表进行关联操作。

######  优点：如果在关联的字段上有创建索引则比较适合使用该中方式进行关联。

######  缺点：由于在关联之前必须要将两张表进行排序，所以资源消耗比较高，并且对内存要求也比较高。



#### 4.3.hints:可以用来修改执行计划。

​    hints是Oracle中提供一种特殊的语法，用来在sql语句中嵌入一些特定的语法来改变sql语句本来的执行方式。

```plsql
--hints的语法格式：/*+函数(....)*/
```


  注意：

​		1.*和+之间不能有空格

​        2.如果在sql语句中给表起了别名，则在hints语法中必须要使用别名。

​        3.如果hints语法编写错误，不会报错，只是不起作用而已。



--修改执行计划，在查询的时候使用全表扫描  ：   +full(表名)

```plsql
SELECT /*+full(e)*/ * FROM emp e WHERE sal=2450.00;
```



--使用指定的索引进行查询数据        +index(表名 索引名,索引名,....)

```plsql
SELECT /*+index(emp index_sal)*/ * FROM emp WHERE sal=3000 AND job='ANALYST'


```

--修改表的连接方式为：循环嵌套连接   +use_nl(表名,表名)

```plsql
SELECT /*+use_nl(e,d)*/ * FROM emp e,dept d WHERE e.deptno=d.deptno;
```



--修改表的连接方式为：排序合并连接    +use_merge(表名,表名)

```plsql
SELECT /*+use_merge(e,d)*/ * FROM emp e,dept d WHERE e.deptno=d.deptno;
```



--修改表的连接方式为：hash连接    +use_hash(表名,表名)

```plsql
SELECT /*+use_hash(e,d)*/ * FROM emp e,dept d WHERE e.deptno=d.deptno AND e.deptno=30;
```



--设置表查询的并行数量   +parallel(表名,n)

```plsql
SELECT /*+parallel(emp,4)*/ * FROM emp;
```

